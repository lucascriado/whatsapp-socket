<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1>Bem-vindo ao Dashboard</h1>
        <p>Esta é uma página protegida.</p>
        <p>Você é um cliente</p>

        <button type="submit">Se conectar ao whatsapp socket</button>

        <button id="logout" class="btn btn-danger">Logout</button>
        
        <form id="add-employee-form" method="POST" class="mt-4">
            <h3>Adicionar Colaborador</h3>

            <div class="form-group">
                <label for="fullname">Nome Completo</label>
                <input type="text" class="form-control" id="fullname" name="fullname" required>
            </div>

            <div class="form-group">
                <label for="email">E-mail do Colaborador</label>
                <input type="email" class="form-control" id="email" name="email" required>
            </div>

            <div class="form-group">
                <label for="password">Senha (opcional)</label>
                <input type="password" class="form-control" id="password" name="password">
            </div>

            <button type="submit" class="btn btn-primary">Adicionar Colaborador</button>
        </form>


    </div>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            axios.get('/user-info')
                .then(response => {
                    console.log("Usuário logado:", response.data);
                })
                .catch(error => {
                    console.error("Erro ao obter informações do usuário:", error);
                });
        });
    
        document.getElementById('logout').addEventListener('click', function() {
            axios.post('/logout')
                .then(() => {
                    window.location.href = '/login';
                })
                .catch(error => {
                    console.error('Erro ao fazer logout:', error);
                    alert('Erro ao fazer logout');
                });
        });

        document.querySelector('button[type="submit"]').addEventListener('click', function () {
        axios.get('/user-info')
            .then(response => {
                const { auth_token, grupo_id, uuid } = response.data;
                console.log("Token de sessão:", auth_token);
                console.log("Grupo ID:", grupo_id);
                console.log("UUID:", uuid);

                axios.post('http://localhost:3000/connect', {
                    auth_token,
                    grupo_id,
                    uuid
                })
                .then(response => {
                    console.log("Conexão com WhatsApp:", response.data);
                })
                .catch(error => {
                    console.error("Erro ao conectar ao WhatsApp:", error);
                });
            })
            .catch(error => {
                console.error("Erro ao obter informações do usuário:", error);
            });
        });

        document.getElementById("add-employee-form").addEventListener("submit", function (e) {
        e.preventDefault();

        const fullname = document.getElementById("fullname").value;
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;

        axios.get('/user-info')
            .then(response => {
                const grupo_id = response.data.grupo_id;

                return axios.post('/add-employee', {
                    fullname,
                    email,
                    password,
                    grupo_id
                });
            })
            .then(() => {
                alert("Colaborador adicionado com sucesso!");
                document.getElementById("add-employee-form").reset();
            })
            .catch(error => {
                console.error("Erro ao adicionar colaborador:", error);
                alert("Erro ao adicionar colaborador.");
            });
        });

    </script>
</body>
</html>